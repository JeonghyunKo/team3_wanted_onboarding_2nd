{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 목표: 유니콘 기업 발굴하기"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# EDA 목표\n",
    "* 데이터들의 분포 (직원 수, 매출액, 보험료, +@)\n",
    "* 몇몇 회사들 선택하여 데이터 흐름 살펴보기\n",
    "* 데이터 사이의 관계에 대해 유의미한 결론을 찾아봅시다. (아이디어 수립 -> EDA를 통해 관찰)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 유니콘 기업의 정의\n",
    "* 기업가치 10억 달러(=1조 원) 이상\n",
    "* 창업한 지 10년 이하인 비상장 스타트업 기업"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# CB Insights에서 선정한 국내 유니콘 기업 리스트"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 환경 설정"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import numpy as np \n",
    "import pandas as pd\n",
    "\n",
    "import matplotlib.pyplot as plt \n",
    "%matplotlib inline \n",
    "import seaborn as sns \n",
    "\n",
    "import re\n",
    "\n",
    "import plotly.express as px\n",
    "import plotly\n",
    "from sklearn.preprocessing import StandardScaler"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "# 소수점 둘 째 자리까지 표시\n",
    "pd.options.display.float_format = '{:.2f}'.format\n",
    "\n",
    "# 한글 출력을 위해 글꼴 설정\n",
    "plt.rcParams['font.family'] = 'MalgunGothic' \n",
    "\n",
    "import sys\n",
    "\n",
    "# 경고 무시\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 데이터 불러온 후 탐색"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 99801 entries, 0 to 99800\n",
      "Data columns (total 6 columns):\n",
      " #   Column    Non-Null Count  Dtype\n",
      "---  ------    --------------  -----\n",
      " 0   회사ID      99801 non-null  int64\n",
      " 1   연매출액      99801 non-null  int64\n",
      " 2   년도        99801 non-null  int64\n",
      " 3   월         99801 non-null  int64\n",
      " 4   월별_연금보험료  99801 non-null  int64\n",
      " 5   월별_직원수    99801 non-null  int64\n",
      "dtypes: int64(6)\n",
      "memory usage: 4.6 MB\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>회사ID</th>\n",
       "      <th>연매출액</th>\n",
       "      <th>년도</th>\n",
       "      <th>월</th>\n",
       "      <th>월별_연금보험료</th>\n",
       "      <th>월별_직원수</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>99801.00</td>\n",
       "      <td>99801.00</td>\n",
       "      <td>99801.00</td>\n",
       "      <td>99801.00</td>\n",
       "      <td>99801.00</td>\n",
       "      <td>99801.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>276298.17</td>\n",
       "      <td>30535893.43</td>\n",
       "      <td>2016.97</td>\n",
       "      <td>6.71</td>\n",
       "      <td>9734079.21</td>\n",
       "      <td>37.62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>133903.15</td>\n",
       "      <td>301664669.02</td>\n",
       "      <td>0.98</td>\n",
       "      <td>3.51</td>\n",
       "      <td>43472560.17</td>\n",
       "      <td>146.95</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>63.00</td>\n",
       "      <td>-7882176.00</td>\n",
       "      <td>2015.00</td>\n",
       "      <td>1.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>165530.00</td>\n",
       "      <td>1409760.00</td>\n",
       "      <td>2016.00</td>\n",
       "      <td>4.00</td>\n",
       "      <td>1181160.00</td>\n",
       "      <td>6.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>259149.00</td>\n",
       "      <td>3573585.00</td>\n",
       "      <td>2017.00</td>\n",
       "      <td>7.00</td>\n",
       "      <td>2332760.00</td>\n",
       "      <td>11.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>382656.00</td>\n",
       "      <td>9582321.00</td>\n",
       "      <td>2018.00</td>\n",
       "      <td>10.00</td>\n",
       "      <td>5591860.00</td>\n",
       "      <td>24.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>5159723.00</td>\n",
       "      <td>11328779396.00</td>\n",
       "      <td>2019.00</td>\n",
       "      <td>12.00</td>\n",
       "      <td>978067260.00</td>\n",
       "      <td>3133.00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            회사ID           연매출액       년도        월     월별_연금보험료   월별_직원수\n",
       "count   99801.00       99801.00 99801.00 99801.00     99801.00 99801.00\n",
       "mean   276298.17    30535893.43  2016.97     6.71   9734079.21    37.62\n",
       "std    133903.15   301664669.02     0.98     3.51  43472560.17   146.95\n",
       "min        63.00    -7882176.00  2015.00     1.00         0.00     0.00\n",
       "25%    165530.00     1409760.00  2016.00     4.00   1181160.00     6.00\n",
       "50%    259149.00     3573585.00  2017.00     7.00   2332760.00    11.00\n",
       "75%    382656.00     9582321.00  2018.00    10.00   5591860.00    24.00\n",
       "max   5159723.00 11328779396.00  2019.00    12.00 978067260.00  3133.00"
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "company_nps_df = pd.read_csv('C:/Users/s/Desktop/프리온보딩 코스_데이터분석가/company_nps_data.csv', encoding='cp949')\n",
    "\n",
    "company_nps_df.info()\n",
    "company_nps_df.describe()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# 데이터 전처리\n",
    "* 연매출액이 마이너스인 경우와 월별_직원수가 0명인 경우 데이터에서 제외한다.\n",
    "* 연매출액이 3년 이상 집계되는 기업만 남긴다.\n",
    "* 총 평균 매출액이 1조원 이상인 기업 추려내기"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "# 이상치 제외\n",
    "normal_nps_df = company_nps_df.drop(index=company_nps_df.query('연매출액 < 0').index)\n",
    "normal_nps_df = normal_nps_df.drop(index=company_nps_df.query('월별_직원수 == 0').index)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "# 연매출액 시각화\n",
    "df_연매출 = normal_nps_df.loc[:, [\"년도\",'회사ID','연매출액']]\n",
    "df_연매출 = df_연매출.drop_duplicates('연매출액')\n",
    "df_연매출 = df_연매출.sort_values(by='연매출액' ,ascending=False)\n",
    "\n",
    "연매출_2015 = df_연매출.loc[df_연매출[\"년도\"] == 2015].sort_values(by='연매출액',ascending=False)\n",
    "연매출_2016 = df_연매출.loc[df_연매출[\"년도\"] == 2016].sort_values(by='연매출액',ascending=False)\n",
    "연매출_2017 = df_연매출.loc[df_연매출[\"년도\"] == 2017].sort_values(by='연매출액',ascending=False)\n",
    "연매출_2018 = df_연매출.loc[df_연매출[\"년도\"] == 2018].sort_values(by='연매출액',ascending=False)\n",
    "연매출_2019 = df_연매출.loc[df_연매출[\"년도\"] == 2019].sort_values(by='연매출액',ascending=False)\n",
    "연매출_concat = pd.concat([연매출_2015,연매출_2016,연매출_2017,연매출_2018,연매출_2019])\n",
    "\n",
    "fig = px.line(연매출_concat, \n",
    "              x='년도', \n",
    "              y='연매출액',\n",
    "              color=\"회사ID\"\n",
    "              )\n",
    "fig"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>회사ID</th>\n",
       "      <th>연매출액</th>\n",
       "      <th>년도</th>\n",
       "      <th>월</th>\n",
       "      <th>월별_연금보험료</th>\n",
       "      <th>월별_직원수</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>11974</th>\n",
       "      <td>14271</td>\n",
       "      <td>8388401</td>\n",
       "      <td>2018</td>\n",
       "      <td>12</td>\n",
       "      <td>4685640</td>\n",
       "      <td>23</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19588</th>\n",
       "      <td>14271</td>\n",
       "      <td>1199495</td>\n",
       "      <td>2015</td>\n",
       "      <td>11</td>\n",
       "      <td>2571840</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8568</th>\n",
       "      <td>14271</td>\n",
       "      <td>5005248</td>\n",
       "      <td>2017</td>\n",
       "      <td>10</td>\n",
       "      <td>3851360</td>\n",
       "      <td>18</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6456</th>\n",
       "      <td>14271</td>\n",
       "      <td>9039340</td>\n",
       "      <td>2019</td>\n",
       "      <td>1</td>\n",
       "      <td>4519140</td>\n",
       "      <td>22</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4503</th>\n",
       "      <td>14271</td>\n",
       "      <td>4257715</td>\n",
       "      <td>2016</td>\n",
       "      <td>3</td>\n",
       "      <td>3016340</td>\n",
       "      <td>13</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3440</th>\n",
       "      <td>515264</td>\n",
       "      <td>2422405</td>\n",
       "      <td>2018</td>\n",
       "      <td>3</td>\n",
       "      <td>743100</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1339</th>\n",
       "      <td>515264</td>\n",
       "      <td>1489321</td>\n",
       "      <td>2016</td>\n",
       "      <td>1</td>\n",
       "      <td>785860</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1653</th>\n",
       "      <td>516653</td>\n",
       "      <td>1500046</td>\n",
       "      <td>2018</td>\n",
       "      <td>9</td>\n",
       "      <td>672380</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5054</th>\n",
       "      <td>516653</td>\n",
       "      <td>1745520</td>\n",
       "      <td>2016</td>\n",
       "      <td>10</td>\n",
       "      <td>449260</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10637</th>\n",
       "      <td>516653</td>\n",
       "      <td>1956460</td>\n",
       "      <td>2017</td>\n",
       "      <td>7</td>\n",
       "      <td>594160</td>\n",
       "      <td>5</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5805 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "         회사ID     연매출액    년도   월  월별_연금보험료  월별_직원수\n",
       "11974   14271  8388401  2018  12   4685640      23\n",
       "19588   14271  1199495  2015  11   2571840      11\n",
       "8568    14271  5005248  2017  10   3851360      18\n",
       "6456    14271  9039340  2019   1   4519140      22\n",
       "4503    14271  4257715  2016   3   3016340      13\n",
       "...       ...      ...   ...  ..       ...     ...\n",
       "3440   515264  2422405  2018   3    743100       5\n",
       "1339   515264  1489321  2016   1    785860       5\n",
       "1653   516653  1500046  2018   9    672380       5\n",
       "5054   516653  1745520  2016  10    449260       4\n",
       "10637  516653  1956460  2017   7    594160       5\n",
       "\n",
       "[5805 rows x 6 columns]"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 연매출액 데이터가 3년 이상 존재하는 회사로만 추리기\n",
    "valid1_df = normal_nps_df.drop_duplicates('연매출액')\n",
    "valid2_df = valid1_df.groupby(\"회사ID\").filter(lambda x : len(x) >= 3)\n",
    "valid2_df.sort_values(by=['회사ID'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "# 간소화된 데이터셋\n",
    "valid_sub = valid2_df.drop(['월'], axis=1)\n",
    "lv=valid_sub.sort_values('회사ID')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>총평균매출액</th>\n",
       "      <th>전체월평균직원수</th>\n",
       "      <th>전체월평균연금보험료</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>회사ID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>419945</th>\n",
       "      <td>8353127318.00</td>\n",
       "      <td>2705.75</td>\n",
       "      <td>847104810.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>227415</th>\n",
       "      <td>5241048566.25</td>\n",
       "      <td>2268.00</td>\n",
       "      <td>829555475.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>227414</th>\n",
       "      <td>4459101961.50</td>\n",
       "      <td>2294.25</td>\n",
       "      <td>852461055.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>419977</th>\n",
       "      <td>4252085666.67</td>\n",
       "      <td>1284.33</td>\n",
       "      <td>390352666.67</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>294649</th>\n",
       "      <td>3833816138.25</td>\n",
       "      <td>274.25</td>\n",
       "      <td>101301110.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>419998</th>\n",
       "      <td>3538392528.67</td>\n",
       "      <td>810.33</td>\n",
       "      <td>300360266.67</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>126831</th>\n",
       "      <td>2015576589.25</td>\n",
       "      <td>586.75</td>\n",
       "      <td>224264945.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>420008</th>\n",
       "      <td>1466671121.67</td>\n",
       "      <td>466.33</td>\n",
       "      <td>177602133.33</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>381180</th>\n",
       "      <td>1434089780.75</td>\n",
       "      <td>171.75</td>\n",
       "      <td>64561640.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297874</th>\n",
       "      <td>1131215860.25</td>\n",
       "      <td>36.50</td>\n",
       "      <td>7978820.00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              총평균매출액  전체월평균직원수   전체월평균연금보험료\n",
       "회사ID                                       \n",
       "419945 8353127318.00   2705.75 847104810.00\n",
       "227415 5241048566.25   2268.00 829555475.00\n",
       "227414 4459101961.50   2294.25 852461055.00\n",
       "419977 4252085666.67   1284.33 390352666.67\n",
       "294649 3833816138.25    274.25 101301110.00\n",
       "419998 3538392528.67    810.33 300360266.67\n",
       "126831 2015576589.25    586.75 224264945.00\n",
       "420008 1466671121.67    466.33 177602133.33\n",
       "381180 1434089780.75    171.75  64561640.00\n",
       "297874 1131215860.25     36.50   7978820.00"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 총 평균 매출 1조원 이상의 회사들로 구성된 데이터프레임\n",
    "avg_df = valid_sub.groupby(\"회사ID\")['연매출액', '월별_직원수', '월별_연금보험료'].mean()\n",
    "avg_df = avg_df.rename({'연매출액': '총평균매출액', '월별_직원수' : '전체월평균직원수', '월별_연금보험료': '전체월평균연금보험료'}, axis = 1)\n",
    "top_df = avg_df.sort_values(by='총평균매출액', ascending = False)\n",
    "Unicorn_df = top_df.loc[(top_df['총평균매출액']>=1000000000)]\n",
    "Unicorn_df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>총평균매출액</th>\n",
       "      <th>전체월평균직원수</th>\n",
       "      <th>전체월평균연금보험료</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>회사ID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>419945</th>\n",
       "      <td>8353127318.00</td>\n",
       "      <td>2705.75</td>\n",
       "      <td>847104810.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>227415</th>\n",
       "      <td>5241048566.25</td>\n",
       "      <td>2268.00</td>\n",
       "      <td>829555475.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>227414</th>\n",
       "      <td>4459101961.50</td>\n",
       "      <td>2294.25</td>\n",
       "      <td>852461055.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>419977</th>\n",
       "      <td>4252085666.67</td>\n",
       "      <td>1284.33</td>\n",
       "      <td>390352666.67</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>294649</th>\n",
       "      <td>3833816138.25</td>\n",
       "      <td>274.25</td>\n",
       "      <td>101301110.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>231703</th>\n",
       "      <td>103442036.25</td>\n",
       "      <td>66.50</td>\n",
       "      <td>22563885.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>130386</th>\n",
       "      <td>103398216.75</td>\n",
       "      <td>105.75</td>\n",
       "      <td>29477580.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>294790</th>\n",
       "      <td>102728765.50</td>\n",
       "      <td>186.50</td>\n",
       "      <td>42477630.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>433492</th>\n",
       "      <td>101917137.33</td>\n",
       "      <td>4.33</td>\n",
       "      <td>1039553.33</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>295805</th>\n",
       "      <td>100710918.33</td>\n",
       "      <td>79.00</td>\n",
       "      <td>22843620.00</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>71 rows × 3 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              총평균매출액  전체월평균직원수   전체월평균연금보험료\n",
       "회사ID                                       \n",
       "419945 8353127318.00   2705.75 847104810.00\n",
       "227415 5241048566.25   2268.00 829555475.00\n",
       "227414 4459101961.50   2294.25 852461055.00\n",
       "419977 4252085666.67   1284.33 390352666.67\n",
       "294649 3833816138.25    274.25 101301110.00\n",
       "...              ...       ...          ...\n",
       "231703  103442036.25     66.50  22563885.00\n",
       "130386  103398216.75    105.75  29477580.00\n",
       "294790  102728765.50    186.50  42477630.00\n",
       "433492  101917137.33      4.33   1039553.33\n",
       "295805  100710918.33     79.00  22843620.00\n",
       "\n",
       "[71 rows x 3 columns]"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 3년 이상 평균 매출액이 1000억원 이상인 회사들 리스트 \n",
    "revnu_list = top_df.loc[(top_df['총평균매출액'] >= 100000000)]\n",
    "revnu_list"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {
    "scrolled": false
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>연매출액_증가율</th>\n",
       "      <th>월평균직원수_증가율</th>\n",
       "      <th>월평균연금보험료_증가율</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>회사ID</th>\n",
       "      <th>년도</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>126516</th>\n",
       "      <th>2015</th>\n",
       "      <td>0.00</td>\n",
       "      <td>0.00</td>\n",
       "      <td>0.00</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"2\" valign=\"top\">126606</th>\n",
       "      <th>2017</th>\n",
       "      <td>-2.85</td>\n",
       "      <td>-42.29</td>\n",
       "      <td>-43.88</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>0.42</td>\n",
       "      <td>-3.00</td>\n",
       "      <td>3.66</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">126831</th>\n",
       "      <th>2015</th>\n",
       "      <td>93.20</td>\n",
       "      <td>-37.25</td>\n",
       "      <td>-37.47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016</th>\n",
       "      <td>-12.38</td>\n",
       "      <td>-0.68</td>\n",
       "      <td>-0.62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>19.90</td>\n",
       "      <td>0.68</td>\n",
       "      <td>10.27</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>4.95</td>\n",
       "      <td>-0.17</td>\n",
       "      <td>-0.17</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">227414</th>\n",
       "      <th>2015</th>\n",
       "      <td>83.47</td>\n",
       "      <td>271.55</td>\n",
       "      <td>227.31</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016</th>\n",
       "      <td>4.03</td>\n",
       "      <td>1.05</td>\n",
       "      <td>0.52</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>10.29</td>\n",
       "      <td>7.08</td>\n",
       "      <td>17.46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>6.23</td>\n",
       "      <td>3.05</td>\n",
       "      <td>6.30</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">227415</th>\n",
       "      <th>2015</th>\n",
       "      <td>0.57</td>\n",
       "      <td>-10.24</td>\n",
       "      <td>-20.93</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016</th>\n",
       "      <td>2.66</td>\n",
       "      <td>3.30</td>\n",
       "      <td>8.82</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>5.78</td>\n",
       "      <td>-0.53</td>\n",
       "      <td>-0.39</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>2.47</td>\n",
       "      <td>6.60</td>\n",
       "      <td>9.09</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">294649</th>\n",
       "      <th>2015</th>\n",
       "      <td>-30.76</td>\n",
       "      <td>-88.62</td>\n",
       "      <td>-89.14</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016</th>\n",
       "      <td>-9.81</td>\n",
       "      <td>0.74</td>\n",
       "      <td>1.20</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>13.48</td>\n",
       "      <td>1.46</td>\n",
       "      <td>4.55</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>6.14</td>\n",
       "      <td>-1.80</td>\n",
       "      <td>1.13</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">297874</th>\n",
       "      <th>2015</th>\n",
       "      <td>-75.58</td>\n",
       "      <td>-88.64</td>\n",
       "      <td>-93.79</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>48.08</td>\n",
       "      <td>38.71</td>\n",
       "      <td>47.95</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>-25.69</td>\n",
       "      <td>-6.98</td>\n",
       "      <td>-8.73</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">381180</th>\n",
       "      <th>2015</th>\n",
       "      <td>19.84</td>\n",
       "      <td>347.50</td>\n",
       "      <td>632.21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2016</th>\n",
       "      <td>-1.04</td>\n",
       "      <td>-3.35</td>\n",
       "      <td>1.25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>10.15</td>\n",
       "      <td>-2.31</td>\n",
       "      <td>-4.10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>11.08</td>\n",
       "      <td>-1.78</td>\n",
       "      <td>6.28</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"4\" valign=\"top\">419945</th>\n",
       "      <th>2016</th>\n",
       "      <td>339.08</td>\n",
       "      <td>1557.23</td>\n",
       "      <td>1103.62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>10.49</td>\n",
       "      <td>-5.45</td>\n",
       "      <td>-0.36</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>6.84</td>\n",
       "      <td>-0.08</td>\n",
       "      <td>5.67</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019</th>\n",
       "      <td>19.87</td>\n",
       "      <td>10.50</td>\n",
       "      <td>13.25</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">419977</th>\n",
       "      <th>2016</th>\n",
       "      <td>-56.91</td>\n",
       "      <td>-54.28</td>\n",
       "      <td>-61.16</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>-1.61</td>\n",
       "      <td>-0.38</td>\n",
       "      <td>4.81</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>-2.53</td>\n",
       "      <td>-5.81</td>\n",
       "      <td>6.57</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">419998</th>\n",
       "      <th>2016</th>\n",
       "      <td>-15.38</td>\n",
       "      <td>-34.42</td>\n",
       "      <td>-31.10</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>1.92</td>\n",
       "      <td>0.50</td>\n",
       "      <td>8.34</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>-2.02</td>\n",
       "      <td>-0.12</td>\n",
       "      <td>-0.19</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">420008</th>\n",
       "      <th>2016</th>\n",
       "      <td>-57.59</td>\n",
       "      <td>-58.32</td>\n",
       "      <td>-61.02</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2017</th>\n",
       "      <td>8.00</td>\n",
       "      <td>-2.07</td>\n",
       "      <td>-1.64</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2018</th>\n",
       "      <td>-19.08</td>\n",
       "      <td>120.54</td>\n",
       "      <td>149.75</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "             연매출액_증가율  월평균직원수_증가율  월평균연금보험료_증가율\n",
       "회사ID   년도                                      \n",
       "126516 2015      0.00        0.00          0.00\n",
       "126606 2017     -2.85      -42.29        -43.88\n",
       "       2018      0.42       -3.00          3.66\n",
       "126831 2015     93.20      -37.25        -37.47\n",
       "       2016    -12.38       -0.68         -0.62\n",
       "       2017     19.90        0.68         10.27\n",
       "       2018      4.95       -0.17         -0.17\n",
       "227414 2015     83.47      271.55        227.31\n",
       "       2016      4.03        1.05          0.52\n",
       "       2017     10.29        7.08         17.46\n",
       "       2018      6.23        3.05          6.30\n",
       "227415 2015      0.57      -10.24        -20.93\n",
       "       2016      2.66        3.30          8.82\n",
       "       2017      5.78       -0.53         -0.39\n",
       "       2018      2.47        6.60          9.09\n",
       "294649 2015    -30.76      -88.62        -89.14\n",
       "       2016     -9.81        0.74          1.20\n",
       "       2017     13.48        1.46          4.55\n",
       "       2018      6.14       -1.80          1.13\n",
       "297874 2015    -75.58      -88.64        -93.79\n",
       "       2017     48.08       38.71         47.95\n",
       "       2018    -25.69       -6.98         -8.73\n",
       "381180 2015     19.84      347.50        632.21\n",
       "       2016     -1.04       -3.35          1.25\n",
       "       2017     10.15       -2.31         -4.10\n",
       "       2018     11.08       -1.78          6.28\n",
       "419945 2016    339.08     1557.23       1103.62\n",
       "       2017     10.49       -5.45         -0.36\n",
       "       2018      6.84       -0.08          5.67\n",
       "       2019     19.87       10.50         13.25\n",
       "419977 2016    -56.91      -54.28        -61.16\n",
       "       2017     -1.61       -0.38          4.81\n",
       "       2018     -2.53       -5.81          6.57\n",
       "419998 2016    -15.38      -34.42        -31.10\n",
       "       2017      1.92        0.50          8.34\n",
       "       2018     -2.02       -0.12         -0.19\n",
       "420008 2016    -57.59      -58.32        -61.02\n",
       "       2017      8.00       -2.07         -1.64\n",
       "       2018    -19.08      120.54        149.75"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 연매출 & 연직원수 증가율 파악\n",
    "yearly_df = valid_sub.groupby(['회사ID','년도'])['연매출액', '월별_직원수', '월별_연금보험료'].mean()\n",
    "yearly_df = yearly_df.rename({'월별_직원수' : '월평균직원수', '월별_연금보험료': '월평균연금보험료'}, axis = 1)\n",
    "top_yearly_df = yearly_df.loc[yearly_df['연매출액']>1000000000]\n",
    "\n",
    "yearly_change_df=top_yearly_df.pct_change()*100\n",
    "yearly_change_df=yearly_change_df.rename({'연매출액' : '연매출액_증가율', '월평균직원수': '월평균직원수_증가율', '월평균연금보험료' : '월평균연금보험료_증가율'}, axis = 1)\n",
    "yearly_change_df.fillna(0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>연매출액_증가율</th>\n",
       "      <th>월평균직원수_증가율</th>\n",
       "      <th>월평균연금보험료_증가율</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>회사ID</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>126831</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>227414</th>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "      <td>4</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>227415</th>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>294649</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297874</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>381180</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>419945</th>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "      <td>2</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>419998</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        연매출액_증가율  월평균직원수_증가율  월평균연금보험료_증가율\n",
       "회사ID                                      \n",
       "126831         1           1             1\n",
       "227414         4           4             4\n",
       "227415         2           2             2\n",
       "294649         1           1             1\n",
       "297874         1           1             1\n",
       "381180         1           1             1\n",
       "419945         2           2             2\n",
       "419998         1           1             1"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# 연매출액 증가율과 월평균직원수 증가율이 마이너스인 회사들 제외\n",
    "pos_yearly_change_df = yearly_change_df.loc[yearly_change_df['연매출액_증가율']>0]\n",
    "pos2_yearly_change_df = pos_yearly_change_df.loc[pos_yearly_change_df['월평균직원수_증가율']>0]\n",
    "pos2_yearly_change_df.groupby(['회사ID']).count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 120,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "[93.19734902568308,\n",
       " 4.954008652360309,\n",
       " 4.03300885980673,\n",
       " 6.22684792466166,\n",
       " 0.5713075480279217]"
      ]
     },
     "execution_count": 120,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "company_list =[]\n",
    "for i in range(len(yearly_change_df.groupby('회사ID'))):\n",
    "    if i > 1:\n",
    "        if yearly_change_df.iloc[i, 1] < yearly_change_df.iloc[i-1, 1]:\n",
    "            company_list.append(yearly_change_df.iloc[i, 0])\n",
    "company_list"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "# '월별_연금보험료'로부터 직원 1인당 기준소득월액 구하기\n",
    "normal_nps_df['기준소득월액'] = normal_nps_df['월별_연금보험료']*(100/9)\n",
    "normal_nps_df['직원1인당_평균기준소득월액'] = normal_nps_df['기준소득월액']/normal_nps_df['월별_직원수']\n",
    "normal_nps_df.sort_values(by = ['연매출액', '월별_직원수'], ascending = [False, False])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "* 연금보험료 = 기준소득월액 X 9%(연금보험료율)\n",
    "\n",
    "* 국민연금보험료는 근로자와 사용자가 각각 반씩 부담을 하여 납부를 합니다. 내 월급통장에서 국민연금보험료로 나가는 돈은 기준소득월액의 4.5%입니다. 단, 지역가입자, 임의(계속)가입자는 본인이 전액(=기준소득월액 × 9.0%) 부담을 합니다.\n",
    "\n",
    "* 기준소득월액 \n",
    "        국민연금의 보험료 및 급여 산정을 위하여 가입자가 신고한 소득월액에서 천원미만을 절사한 금액을 말하며, 최저33만원에서 최고 524만원까지의 범위로 결정하게 됩니다. \n",
    "        따라서, 신고한 소득월액이 33만원보다 적으면 33만원을 기준소득월액으로 하고, 524만원보다 많으면 524만원을 기준소득월액으로 합니다. (2021.7.1 기준)\n",
    "\n",
    "* 기준소득월액 상한액과 하한액\n",
    "        기준소득월액 상한액과 하한액은 국민연금 사업장가입자와 지역가입자 전원(납부예외자 제외)의 평균소득월액의 3년간 변동하는 비율을 반영하여 매년 3월말까지 보건복지부 장관이 고시하며 해당연도 7월부터 1년간 적용합니다."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
